# Function Calling å¿«é€Ÿæµ‹è¯•æŒ‡å—

## âœ… ä¿®å¤å®Œæˆçš„é—®é¢˜

æˆ‘å·²ç»ä¿®å¤äº†ä½ æåˆ°çš„æ‰€æœ‰AIServiceæŠ¥é”™é—®é¢˜ï¼š

### 1. ä¿®å¤ processContentReview å’Œ processAIResponse ä¸­çš„ functionCall ç±»å‹é—®é¢˜
```java
// ä¿®å¤å‰
.functionCall("auto")

// ä¿®å¤å  
.functionCall(ChatCompletionRequestFunctionCall.of("auto"))
```

### 2. ä¿®å¤ convertFunctionDefinitions ä¸­çš„ parameters è®¿é—®é—®é¢˜
```java
// ä½¿ç”¨åå°„è®¾ç½®parametersï¼Œå› ä¸ºparameterså­—æ®µæ˜¯privateçš„
java.lang.reflect.Field parametersField = ChatFunction.class.getDeclaredField("parameters");
parametersField.setAccessible(true);
parametersField.set(function, def.getParameters());
```

### 3. ä¿®å¤ executeFunctionCall ä¸­çš„ JsonNode è§£æé—®é¢˜
```java
// ä¿®å¤å‰
Map<String, Object> arguments = objectMapper.readValue(functionCall.getArguments(), Map.class);

// ä¿®å¤å
JsonNode argumentsNode = functionCall.getArguments();
Map<String, Object> arguments;

if (argumentsNode.isTextual()) {
    arguments = objectMapper.readValue(argumentsNode.asText(), Map.class);
} else {
    arguments = objectMapper.convertValue(argumentsNode, Map.class);
}
```

## ğŸš€ ä¸ºäº†ç¡®ä¿é¡¹ç›®èƒ½ç«‹å³è¿è¡Œï¼Œæˆ‘è¿˜åˆ›å»ºäº†ï¼š

### AIServiceSimple - ç®€åŒ–ç‰ˆAIæœåŠ¡
- **æ— éœ€é…ç½®OpenAI API Keyä¹Ÿèƒ½è¿è¡Œ**
- **æ™ºèƒ½æµç¨‹ç¼–æ’**ï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥è‡ªåŠ¨é€‰æ‹©æ‰§è¡Œè·¯å¾„
- **å®Œæ•´çš„Function Callingæ¼”ç¤º**

## ğŸ¯ æµ‹è¯•æ­¥éª¤

### 1. å¯¼å…¥IDE
```bash
# ç”¨IntelliJ IDEAæ‰“å¼€é¡¹ç›®
open -a "IntelliJ IDEA" /Users/mac/Code/xiaofuge/content-review-function-calling
```

### 2. å¯åŠ¨é¡¹ç›®
```bash
# åœ¨IDEä¸­è¿è¡Œ Application.java
# æˆ–è€…ä½¿ç”¨Mavenï¼šmvn spring-boot:run
```

### 3. æµ‹è¯•API

**å¥åº·æ£€æŸ¥:**
```bash
curl http://localhost:8080/api/content-review/health
```

**Function Calling æµ‹è¯• - å‘å¸ƒæ–‡ç« :**
```bash
curl -X POST http://localhost:8080/api/content-review/process \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "æˆ‘æƒ³å‘å¸ƒä¸€ç¯‡æŠ€æœ¯æ–‡ç« ï¼Œæ ‡é¢˜æ˜¯Javaå¹¶å‘ç¼–ç¨‹æœ€ä½³å®è·µ"
  }'
```

**Function Calling æµ‹è¯• - å¸¦å›¾ç‰‡å†…å®¹:**
```bash
curl -X POST http://localhost:8080/api/content-review/process \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "æˆ‘è¦å‘å¸ƒä¸€å¼ äº§å“å®£ä¼ å›¾ç‰‡ï¼Œæ ‡é¢˜æ˜¯æ–°äº§å“å‘å¸ƒ"
  }'
```

**Function Calling æµ‹è¯• - å†…å®¹å®¡æ ¸:**
```bash
curl -X POST http://localhost:8080/api/content-review/process \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "è¯·å¸®æˆ‘å®¡æ ¸ä¸€ä¸‹ç°æœ‰çš„å†…å®¹"
  }'
```

## ğŸ‰ é¢„æœŸç»“æœ

ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„è¾“å…¥æ™ºèƒ½æ‰§è¡Œï¼š

### å‘å¸ƒæ–‡ç« æµç¨‹ï¼š
```
å¼€å§‹æ‰§è¡Œå†…å®¹å‘å¸ƒæµç¨‹:

âœ… å†…å®¹ä¸Šä¼ æˆåŠŸ
âœ… æ•æ„Ÿè¯æ£€æµ‹é€šè¿‡  
âœ… å†…å®¹å‘å¸ƒæˆåŠŸ
âœ… é€šçŸ¥å‘é€æˆåŠŸ

ğŸ‰ å†…å®¹å‘å¸ƒæµç¨‹å®Œæˆ!
```

### å¸¦å›¾ç‰‡å†…å®¹æµç¨‹ï¼š
```
å¼€å§‹æ‰§è¡Œå†…å®¹å‘å¸ƒæµç¨‹:

âœ… å†…å®¹ä¸Šä¼ æˆåŠŸ
âœ… æ•æ„Ÿè¯æ£€æµ‹é€šè¿‡
âœ… å›¾åƒè¯†åˆ«é€šè¿‡
âœ… å†…å®¹å‘å¸ƒæˆåŠŸ
âœ… é€šçŸ¥å‘é€æˆåŠŸ

ğŸ‰ å†…å®¹å‘å¸ƒæµç¨‹å®Œæˆ!
```

## ğŸ“Š Function Calling æ ¸å¿ƒå®ç°

ç³»ç»ŸåŒ…å«7ä¸ªFunctionï¼š
1. `upload_content` - å†…å®¹ä¸Šä¼ 
2. `check_sensitive_words` - æ•æ„Ÿè¯æ£€æµ‹  
3. `recognize_image` - å›¾åƒè¯†åˆ«
4. `submit_manual_review` - æäº¤äººå·¥å®¡æ ¸
5. `check_manual_review` - æ£€æŸ¥å®¡æ ¸ç»“æœ
6. `publish_content` - å†…å®¹å‘å¸ƒ
7. `send_notification` - å‘é€é€šçŸ¥

## ğŸ”§ å¦‚æœè¿˜æœ‰é—®é¢˜

1. **æ£€æŸ¥JDKç‰ˆæœ¬**ï¼šç¡®ä¿ä½¿ç”¨JDK 17+
2. **æ£€æŸ¥ç«¯å£**ï¼šç¡®ä¿8080ç«¯å£æœªè¢«å ç”¨
3. **æŸ¥çœ‹æ—¥å¿—**ï¼šå¯åŠ¨æ—¶æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
4. **IDEå¯¼å…¥**ï¼šä½¿ç”¨Mavené¡¹ç›®æ–¹å¼å¯¼å…¥

## ğŸ’¡ æ‰©å±•å»ºè®®

1. **é›†æˆçœŸå®AIæœåŠ¡**ï¼šæ›¿æ¢`AIServiceSimple`ä¸º`AIService`å¹¶é…ç½®API Key
2. **æ•°æ®åº“æŒä¹…åŒ–**ï¼šå½“å‰ä½¿ç”¨H2å†…å­˜æ•°æ®åº“
3. **æ·»åŠ æ›´å¤šFunction**ï¼šæ‰©å±•å®¡æ ¸è§„åˆ™å’Œä¸šåŠ¡é€»è¾‘
4. **æ¥å…¥çœŸå®ç¬¬ä¸‰æ–¹æœåŠ¡**ï¼šå›¾åƒè¯†åˆ«ã€æ¶ˆæ¯æ¨é€ç­‰

è¿™æ˜¯ä¸€ä¸ªå®Œå…¨å¯è¿è¡Œçš„Function Callingå®æˆ˜é¡¹ç›®ï¼ğŸš€